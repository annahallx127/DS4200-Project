<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Interactive Donut Chart – Student Outcomes</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>

<style>
    body {
        font-family: Georgia, "Times New Roman", serif;
        margin: 40px;
        background-color: #fff;
        text-align: center;
    }

    h1 {
        font-size: 24px;
        margin-bottom: 10px;
    }

    .controls {
        margin-bottom: 25px;
        font-size: 16px;
    }

    .controls label {
        margin-right: 15px;
        cursor: pointer;
    }

    #chart {
        margin: 0 auto;
        max-width: 450px;
    }

    /* Tooltip */
    .tooltip {
        position: absolute;
        background: white;
        border: 1px solid #ccc;
        padding: 8px 10px;
        border-radius: 6px;
        pointer-events: none;
        font-size: 14px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        opacity: 0;
        transition: opacity 0.15s;
    }
</style>
</head>
<body>

<p>Select a performance group to explore the outcome distribution.</p>

<div class="controls">
    <label><input type="radio" name="group" value="all" checked> All Students</label>
    <label><input type="radio" name="group" value="high"> High Performers (5–6 classes passed)</label>
    <label><input type="radio" name="group" value="medium"> Medium Performers (3–4 classes passed)</label>
    <label><input type="radio" name="group" value="low"> At-Risk (0–2 classes passed)</label>
</div>

<div id="chart"></div>
<div class="tooltip" id="tooltip"></div>

<script>
d3.json("data/donut_chart_data.json").then(function(data) {

    const width = 420,
          height = 420,
          radius = 180;

    const tooltip = d3.select("#tooltip");

    const color = d3.scaleOrdinal()
        .domain(["Graduate", "Dropout", "Enrolled"])
        .range(["#2ca02c", "#d62728", "#ff7f0e"]);

    const arc = d3.arc()
        .innerRadius(radius * 0.6)
        .outerRadius(radius);

    const pie = d3.pie()
        .sort(null)
        .value(d => d.value);

    const svg = d3.select("#chart")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr("transform", `translate(${width/2}, ${height/2})`);

    let arcsGroup = svg.append("g");

    function updateChart(groupName) {
        const dataset = data[groupName].outcomes;
        const total = data[groupName].total;

        const arcs = arcsGroup.selectAll("path")
            .data(pie(dataset));

        arcs.join(
            enter => enter.append("path")
                .attr("fill", d => color(d.data.outcome))
                .attr("d", arc)
                .each(function(d) { this._current = d; })
                .on("mousemove", (event, d) => {
                    const percent = ((d.data.value / total) * 100).toFixed(1);
                    tooltip
                        .style("opacity", 1)
                        .html(`
                            <strong>${d.data.outcome}</strong><br>
                            Count: ${d.data.value.toLocaleString()}<br>
                            ${percent}% of group
                        `)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 20) + "px");
                })
                .on("mouseout", () => {
                    tooltip.style("opacity", 0);
                }),

            update => update.transition().duration(600)
                .attrTween("d", function(d) {
                    const i = d3.interpolate(this._current, d);
                    this._current = i(1);
                    return t => arc(i(t));
                }),

            exit => exit.remove()
        );

        const labels = svg.selectAll("text.label")
            .data(pie(dataset));

        labels.join(
            enter => enter.append("text")
                .attr("class", "label")
                .attr("text-anchor", "middle")
                .attr("font-size", "13px")
                .attr("transform", d => `translate(${arc.centroid(d)})`)
                .text(d => d.data.outcome),

            update => update.transition().duration(600)
                .attr("transform", d => `translate(${arc.centroid(d)})`)
                .text(d => d.data.outcome),

            exit => exit.remove()
        );
    }

    updateChart("all");

    d3.selectAll("input[name='group']").on("change", function() {
        updateChart(this.value);
    });

});
</script>

</body>
</html>